# Обновление функциональности просмотра Word документов

## Что изменилось

Система просмотра Word документов была значительно улучшена для сохранения форматирования при отображении документов в веб-интерфейсе.

### До обновления
- Извлекался только простой текст из Word документов
- Все форматирование терялось
- Документы отображались как обычный текст

### После обновления
- Сохраняется полное форматирование документов
- Поддерживаются заголовки разных уровней (H1-H6)
- Сохраняется жирный, курсивный и подчеркнутый текст
- Поддерживается зачеркнутый текст
- Отображаются маркированные и нумерованные списки
- Поддерживаются таблицы с форматированием

## Технические изменения

### Backend (Python/FastAPI)

1. **Новая функция конвертации**: `convert_docx_to_html_with_formatting()`
   - Использует библиотеку `python-docx` для извлечения структурированного содержимого
   - Конвертирует Word документы в HTML с сохранением форматирования
   - Поддерживает fallback на `docx2txt` в случае ошибок

2. **Обновленные маршруты**:
   - `/content/view-word/{content_id}` - теперь возвращает HTML с форматированием
   - `/content/word-content/{content_id}` - теперь возвращает HTML с форматированием

3. **Поддерживаемые элементы форматирования**:
   - Заголовки (H1-H6)
   - Жирный текст (`<strong>`)
   - Курсивный текст (`<em>`)
   - Подчеркнутый текст (`<u>`)
   - Зачеркнутый текст (`<del>`)
   - Маркированные списки (`<ul>`)
   - Нумерованные списки (`<ol>`)
   - Таблицы (`<table>`)

### Frontend (Vue.js)

1. **Обновленные стили в WordViewer.vue**:
   - Добавлены CSS классы для всех типов форматирования
   - Улучшена читаемость документов
   - Поддержка таблиц и списков

2. **Совместимость**:
   - Все существующие функции работают без изменений
   - Модальные окна отображают форматированный контент
   - Скачивание документов работает как прежде

## Тестирование

Для проверки функциональности создан тестовый скрипт:

```bash
cd server
python test_word_formatting_conversion.py
```

Скрипт создает тестовый Word документ с различными типами форматирования и проверяет корректность конвертации.

## Ограничения

- Поддерживаются только файлы формата .docx (не .doc)
- Изображения в документах не отображаются
- Сложные элементы форматирования (цвета, шрифты, размеры) отображаются упрощенно
- Максимальный размер файла ограничен настройками сервера

## Планы развития

- [ ] Поддержка старых форматов .doc
- [ ] Поддержка изображений в документах
- [ ] Сохранение цветов и размеров шрифтов
- [ ] Экспорт в PDF
- [ ] Редактирование документов в браузере
- [ ] Поддержка вложенных списков
- [ ] Поддержка сносок и комментариев

## Миграция

Для существующих проектов миграция не требуется - все изменения обратно совместимы. Существующие документы будут автоматически отображаться с сохранением форматирования при следующем просмотре. 